(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"15b9ade9-0fb6-48e4-9df8-c18fc5002836","Content-Type":"application/json"}},o=fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),c=fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),a=document.querySelector("#card-template").content.querySelector(".card");function i(e,t,n){var r,o=n.deleteCard,c=n.popUpDelete,i=n.likeCard,s=n.openCard,l=a.cloneNode(!0),d=l.querySelector(".card__image"),p=l.querySelector(".card__like_count"),f=l.querySelector(".card__delete-button"),_=l.querySelector(".card__title"),m=e._id,y=l.querySelector(".card__like-button"),v=e.likes;return(r={arrayLikes:v,userId:t,likeBtn:y}).arrayLikes.forEach((function(e){e._id==r.userId&&r.likeBtn.classList.add("card__like-button_is-active")})),d.src=e.link,d.alt=e.name,_.textContent=e.name,u(p,e.likes.length),e.owner._id!==t?l.removeChild(f):f.addEventListener("click",(function(){return o(l,c,m)})),y.addEventListener("click",(function(e){return i(e,{cardLikes:p,cardId:m})})),d.addEventListener("click",(function(){return s(e)})),l}function u(e,t){e.textContent=t}function s(n,o,c){e(o),o.addEventListener("click",(function(e){e.target.classList.contains("popup__button")&&(t(o),function(e){fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c),n.remove())}))}function l(e,t){e.target.classList.contains("card__like-button_is-active")?(e.target.classList.remove("card__like-button_is-active"),d(t,"DELETE")):(e.target.classList.add("card__like-button_is-active"),d(t,"PUT"))}function d(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-12/cards/likes/".concat(e.cardId),{method:t,headers:{authorization:"15b9ade9-0fb6-48e4-9df8-c18fc5002836","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){return u(e.cardLikes,t.likes.length)}))}function p(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function f(e,t,n){t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}var _,m=document.querySelector(".places__list"),y=document.querySelectorAll(".popup"),v=document.forms["edit-profile"],h=v.querySelector(".popup__input_type_name"),S=v.querySelector(".popup__input_type_description"),C=document.forms["new-place"],k=C.querySelector(".popup__input_type_card-name"),b=C.querySelector(".popup__input_type_url"),L=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),j=document.forms["change-profile-image"],P=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_change-profile-image"),A=document.querySelector(".popup__input_type_url-image"),x=document.querySelector(".popup_type_edit"),B=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup_type_image"),T=D.querySelector(".popup__image"),w=D.querySelector(".popup__caption"),I=document.querySelector(".popup_type_confirm-delete"),N="popup__button_disabled",O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:N,inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error-active"},H="";function J(e){E.textContent=e.name,g.textContent=e.about,P.style.backgroundImage="url(".concat(e.avatar,")")}function z(t){T.src=t.link,T.alt=t.name,w.textContent=t.name,e(D)}v.addEventListener("submit",(function(e){var n;e.preventDefault(),(n={name:h.value,job:S.value},fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n.name,about:n.job})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return J(e)})).catch((function(e){return console.log(e)})),t(x)})),C.addEventListener("submit",(function(e){e.preventDefault();var n,o=k.value,c=b.value;e.target.reset(),(n={name:o,link:c},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),m.prepend(i(e,H,{deleteCard:s,popUpDelete:I,likeCard:l,openCard:z}))})).catch((function(e){return console.log(e)})),e.target.querySelector(".popup__button").classList.add(N),t(B)})),j.addEventListener("submit",(function(e){var n;e.preventDefault(),(n=A.value,fetch("".concat(n),{method:"HEAD"}).then((function(e){return e.ok&&e.headers.get("Content-Type").includes("image")?function(e){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n):Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return t=e.avatar,void(P.style.backgroundImage="url(".concat(t,")"));var t})),e.target.reset(),t(U)})),q.addEventListener("click",(function(){e(B)})),P.addEventListener("click",(function(){e(U)})),y.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_is-opened")&&t(e),n.target.classList.contains("popup__close")&&t(e)}))})),L.addEventListener("click",(function(){var t,n,r,o,c,a;h.value=E.textContent,S.value=g.textContent,e(x),t=v,n=O,r=Array.from(t.querySelectorAll(n.inputSelector)),o=t.querySelector(n.submitButtonSelector),c=n.inputErrorClass,a=n.errorClass,r.forEach((function(e){f(t,e,{inputErrorClass:c,errorClass:a}),p(r,o,n.inactiveButtonClass)}))})),_=O,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),o=t.inputErrorClass,c=t.errorClass;p(n,r,t.inactiveButtonClass),n.forEach((function(a){a.addEventListener("input",(function(){f(e,a,{inputErrorClass:o,errorClass:c}),p(n,r,t.inactiveButtonClass)}))}))}(e,_)}));var M=[o,c];Promise.all(M).then((function(e){J(e[0]),H=e[0]._id,function(e,t){e.forEach((function(e){m.append(i(e,t,{deleteCard:s,popUpDelete:I,likeCard:l,openCard:z}))}))}(e[1],H)})).catch((function(e){return console.log(e)}))})();